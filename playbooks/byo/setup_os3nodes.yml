---
- hosts: nodes 

  tasks:
  - selinux: policy=targeted state=permissive

  - name: Install Docker
    yum: pkg=docker state=present 

  - name: stop docker service 
    service: name=docker state=stopped 

  - name: remove default docker files
    shell: rm -rf /var/lib/docker/*

  - name: update docker sysconfig
    replace: dest=/etc/sysconfig/docker regularexp="^OPTIONS='--selinux-enabled'$" replace="^OPTIONS='--selinux-enabled --insecure-registry 172.30.0.0/16'$"

  - name: start docker service 
    service: name=docker state=started

  - name: docker storage setup 
    shell: docker-storage-setup

- name: Install Docker
  apt_rpm:  
    pkg: docker
    state: present
  tags: 
  - nodes
  - docker-setup  

- name: stop docker service 
  service: name=docker state=stopped 
  tags: 
  - docker-setup  
  
- name: remove default docker files
  shell: rm -rf /var/lib/docker/*
  tags: 
  - docker-setup  
          
- name: start docker service 
  service: name=docker state=started
  tags: 
  - docker-setup  

- name: docker storage setup 
  shell: docker-storage-setup
  tags: 
  - docker-setup  
